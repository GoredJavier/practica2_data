---
title: "Práctica AE1"
author: "Grupo 1"
date: "`r format(Sys.time(), '%d-%m-%Y')`"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    
---

```{r carga_librerias, include=FALSE}
library(readr)
library(stringr)
library(swirl)
library(RCurl)
library(XML)
library(httr)
library(dplyr)

```

# Autores

**Práctica:** Actividad Evaluable 1  
**Asignatura:** Data Driven Security  
**Fecha:** `r format(Sys.time(), '%d-%m-%Y')`  


|Grupo 1 |  
|:--------|  
|Javier Gómez Rodríguez|  
|Fernando Palma Villanueva|  
|Mireia Náger Piazuelo| 



```{r descarga_pagina, include=FALSE}
base_domain <- "https://www.mediawiki.org"
html <- GET("https://www.mediawiki.org")
content <- content(html, as = "text")
parsedHtml <- htmlParse(content, asText = TRUE)
print(parsedHtml)
```


```{r extrae_contenido, include=FALSE}
 title <- xpathSApply(parsedHtml, "//title", xmlValue)
 texts <- xpathSApply(parsedHtml, "//p", xmlValue)
 links_text <- xpathSApply(parsedHtml, "//a", xmlValue)
 links_url  <- xpathSApply(parsedHtml, "//a", xmlGetAttr, 'href')
```


```{r crea_df, include=FALSE}
df <- data.frame(
  Text = links_text,
  Url = links_url,
  Url_completa = character(179),
  Tipo = character(179)
)
```


```{r define_functions, include=FALSE}
for (i in 1:nrow(df)) {
  if (startsWith(df$Url[i], "/")) {
    df$Tipo[i] = "R"
    df$Url_completa[i] = paste("https://www.mediawiki.org", df$Url[i])
  }
  else if (startsWith(df$Url[i], "#")) {
    df$Tipo[i] = "I"
  }
  else if (startsWith(df$Url[i], "https") || startsWith(df$Url[i], "http"))  {
    df$Tipo[i] = "A"
  }
  else if (startsWith(df$Url[i], "//")) {
    df$Tipo[i] = "S"
    df$Url_completa = paste("https:", df$Url[i])
  }
}
categoria_url <- function(url) {
  if (startsWith(url, "/")) {
    return("R")
  }
  else if (startsWith(url, "#")) {
    return("I")
  }
  else if (startsWith(url, "https") || startsWith(url, "http"))  {
    return("A")
  }
  else if (startsWith(url, "//")) {
    return("S")
  }
}

convertir_absoluta <- function(url) {
  if (startsWith(url, "/") || startsWith(url, "#") || startsWith(url, "//")) {
    return(paste(base_domain, url, sep = ""))
  }
  
  else if (startsWith(url, "https") || startsWith(url, "http"))  {
    return(url)
  }
}
```


```{r count_repeated_urls, include=FALSE}
df$url_absoluta <- sapply(df$Url, convertir_absoluta)
df$tipo_url <- sapply(df$Url, categoria_url)
df_count <- count(df, url_absoluta)
df <- left_join(df, df_count, by = "url_absoluta")
```




```{r request, include=FALSE}
df$status <- sapply((df$url_absoluta), function(url) {
  resp_status(req_perform(request(url)))
})
```


df %>% ggplot(aes(x, y )) + geom_bars()